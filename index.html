<!doctype html>
<html lang="pt-BR">
<head>
  <!-- Metadados e assets principais -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portal do 3º BPM – Operações & Gestor</title>
  <meta name="description" content="Hub do batalhão: operações vigentes, links úteis e área restrita do gestor" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="icon" href="assets/logo.svg" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="container">
    <!-- Cabeçalho (logo + título + versão) -->
    <header>
      <div class="brand">
        <img src="assets/logo.svg" alt="3º BPM" class="logo" />
        <div>
          <h1>Portal do 3º BPM</h1>
          <div class="muted">Operações vigentes, links úteis e área restrita do gestor.</div>
        </div>
      </div>
      <div class="muted" id="versao"></div>
    </header>

    <!-- Abas de navegação -->
    <nav class="tabs" role="tablist" aria-label="Seções">
      <button class="tab" id="tab-op" role="tab" aria-selected="true" aria-controls="painel-op">Operações Vigentes</button>
      <button class="tab" id="tab-gestor" role="tab" aria-selected="false" aria-controls="painel-gestor">Gestor (Restrito)</button>
      <button class="tab" id="tab-escala" role="tab" aria-selected="false" aria-controls="painel-escala">Escala</button>
    </nav>

    <!-- Barra de busca + seletor de status -->
    <div class="bar">
      <label class="search" aria-label="Pesquisar">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/></svg>
        <input id="q" placeholder="Pesquisar por título, descrição ou URL…" />
      </label>
      <div class="select">
        <label for="statusSel" class="muted">Status:</label>
        <select id="statusSel" class="input" style="max-width:200px">
          <option value="Todos">Todos</option>
          <option value="Vigente">Vigente</option>
          <option value="Planejada">Planejada</option>
          <option value="Encerrada">Encerrada</option>
        </select>
      </div>
    </div>

    <!-- Painel: Operações (público) -->
    <section id="painel-op" role="tabpanel" aria-labelledby="tab-op">
      <div id="grid-op" class="grid" role="list"></div>
      <div id="empty-op" class="empty" hidden>Nenhum item encontrado. Ajuste filtros ou busca.</div>
    </section>

    <!-- Painel: Gestor (restrito por PIN) -->
    <section id="painel-gestor" role="tabpanel" aria-labelledby="tab-gestor" hidden>
      <div class="muted" style="margin-bottom:8px">Área restrita. Para sigilo real, use proteção de servidor (Netlify password/Identity). Este PIN é apenas controle local do navegador.</div>
      <div id="grid-gestor" class="grid" role="list"></div>

      <section id="painel-escala">
  <iframe src="assets/escala/escala_setembro_2025.html"
          style="width:100%;height:78vh;border:0;border-radius:12px;"></iframe>
  </section>

      <!-- Distribuição de RP por Turno -->
      <hr style="border:0;border-top:1px dashed var(--ring);margin:18px 0;">
      <h2 style="margin:0 0 6px 0;font-size:18px;">Distribuição de RP por Turno</h2>
      <div class="muted" style="margin-bottom:8px">Consulta por turno e por cidade.</div>

      <div class="toolbar">
        <label class="muted">Turno:</label>
        <select id="turnoSel" class="input">
          <option value="ALFA">ALFA</option>
          <option value="BRAVO">BRAVO</option>
          <option value="CHARLIE">CHARLIE</option>
          <option value="DELTA">DELTA</option>
        </select>

        <label class="muted">Cidade:</label>
        <input id="buscaCidade" class="input" placeholder="Ex.: Arapiraca, Craíbas..." style="max-width:260px">

        <button id="btnLimparFiltro" class="btn">Limpar</button>
      </div>

      <div class="table-wrap">
        <table class="rotina" id="tabelaDistrib">
          <thead>
            <tr>
              <th style="width:260px">Cidade</th>
              <th>RPs atribuídas no turno</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Rotina RP -->
      <hr style="border:0;border-top:1px dashed var(--ring);margin:18px 0;">
      <h2 style="margin:0 0 6px 0;font-size:18px;">Rotina RP</h2>
      <div class="muted" style="margin-bottom:8px">
        Rotina de Serviço – Radiopatrulha – 3º BPM.
      </div>
      <div id="rotina-rp"></div>
      <div id="empty-rp" class="empty" hidden>Nenhum dado de rotina encontrado.</div>

      <div id="empty-gestor" class="empty" hidden>Nenhum item encontrado. Ajuste filtros ou busca.</div>
    </section>

      <!-- Painel: Escala -->
  <section id="painel-escala" role="tabpanel" aria-labelledby="tab-escala" hidden>
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px;">
      <div class="muted">Escala mensal (PDF). Use as opções para imprimir ou visualizar como tabela.</div>
      <div style="margin-left:auto;display:flex;gap:8px;">
        <button id="btnOpenPdf" class="btn">Abrir PDF em nova aba</button>
        <button id="btnShowTable" class="btn">Exibir como tabela</button>
        <button id="btnDownloadPdf" class="btn">Download PDF</button>
      </div>
    </div>
  
    <!-- visualizador simples -->
    <div class="table-wrap" style="height:720px;display:flex;flex-direction:column;">
      <iframe id="escalaPdfFrame" src="assets/escala-setembro-2025.pdf" style="width:100%;height:100%;border:0;" title="Escala - PDF"></iframe>
    </div>
  
    <!-- espaço para a tabela gerada (inicialmente escondida) -->
    <div id="escalaTableWrap" class="table-wrap" style="margin-top:12px;display:none;max-height:560px;overflow:auto;"></div>
  </section>

    <!-- Rodapé -->
    <footer class="footer" id="siteFoot">
      &copy; <span id="year"></span> — P3 · 3º BPM. Todos os direitos reservados.
    </footer>
  </div>

  <!-- Toast (avisos) -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Modal: PIN do Gestor -->
  <div id="modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="ttlModal">
    <div class="sheet">
      <h2 id="ttlModal">Acesso do Gestor</h2>
      <div class="note">PIN salvo apenas localmente. Para conteúdo sigiloso, use autenticação de servidor.</div>
      <div class="row">
        <input id="pin" class="input" type="password" placeholder="Digite o PIN" />
        <button id="pinBtn" class="btn primary">Desbloquear</button>
      </div>
    </div>
  </div>

  <!-- Script principal -->
  <script src="js/script.js"></script>
</body>
</html>
